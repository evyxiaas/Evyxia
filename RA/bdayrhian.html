<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>‚ãÜÀô‚ü° HAPPY BIRTHDAY BESTIE! ‚ãÜÀô‚ü°</title>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      background-image: url('pi.jpg');
      font-family: "Lucida Handwriting", cursive;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      overflow: hidden;
      flex-direction: column;
    }

    .container {
      position: relative;
      width: 1000px;
      height: 320px;
    }

    .envelope {
      position: absolute;
      top: 0;
      left: 50%;
      transform: translateX(-50%);
      width: 600px;
      height: 350px;
      background: pink;
      border-radius: 10px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
      display: flex;
      justify-content: center;
      align-items: center;
      cursor: pointer;
      z-index: 2;
      transition: opacity 0.6s ease;
    }

    .flap {
      position: absolute;
      top: 0;
      width: 100%;
      height: 50%;
      background: #ffb6c1;
      clip-path: polygon(0 0, 100% 0, 50% 100%);
      transform-origin: top center;
      transition: transform 0.8s ease;
      z-index: 3;
    }

    
    .white-box {
      background-image: url(Happy\ Sweet\ Sixteen.png);
      margin-left: 50%;
      margin-top: -45px;
      transform: translateX(-50%) scale(0.8);
      width: 990px; /* increased by 100px */
      height: 550px; /* increased by 100px */
      border-radius: 0px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
      background-size:cover;
      background-position:left;
      display: none;
      flex-direction: column;
      justify-content: center;
      animation: popOut 1s ease forwards;
    }

    .gre {
      color: palevioletred;
      text-align: center;
      margin-bottom: 390px;
      font-size: 32px;

    }




    .open{
color: white;
background-color: pink;
padding-left: 9px;
padding-right: 9px;
padding-top: 1px;
padding-bottom: 1px;
font-size: 20px;
font-family: 'Gill Sans';
border-radius: 10px;
border-width: 3px;
border-color: white;
transition: 0.15s;
}

body {
  cursor: url('pink-removebg-preview.png'), pointer;
}

.no{
color: pink;
background-color: white;
padding-left: 9px;
padding-right: 9px;
padding-top: 1px;
padding-bottom: 1px;
font-size: 20px;
font-family: 'Gill Sans';
border-radius: 10px;
border-width: 3px;
border-color: rgba(255, 192, 203, 0.637);
margin-left: 10px;
transition: 0.15s;
}


.open:hover{
  font-size: 23px;
  cursor: grabbing;
}

.no:hover{
  font-size: 23px;
  cursor: grabbing;
}




    @keyframes popOut {
      0% {
        opacity: 0;
        transform: translateX(-50%) scale(0.5) translateY(100px);
      }
      60% {
        opacity: 1;
        transform: translateX(-50%) scale(1.05) translateY(-10px);
      }
      100% {
        transform: translateX(-50%) scale(1) translateY(0);
      }
    }

    .footer-text {
      margin-top: 50px;
      font-size: 20px;
      margin-bottom: 10px;
      color: palevioletred;
    }


.pui{
  background-color: rgb(190, 60, 60);
}


#confetti-canvas {
  position: fixed;
  top: 0;
  left: 0;
  width: 100vw;
  height: 100vh;
  pointer-events: none;
  z-index: 9999; 
}


.star{
color: white;
background-color: #ffc2c2;
padding-left: 9px;
padding-right: 9px;
padding-top: 1px;
padding-bottom: 1px;
font-size: 39px;
margin-top: 40%;
margin-right: 46.8%;
margin-left: 7.8%;
font-family: 'Gill Sans';
border-radius: 10px;
border-width: 3px;
border-color: white;
transition: 0.15s;
}

.star:hover{
  font-size: 43px;
  cursor: grabbing;
}



.stars:hover, .stars2:hover, .stars3:hover{
  font-size: 20px;
  cursor: grabbing;
}

.stars{ 
color: #ffb6c1;
background-color: white;
padding-left: 9px;
padding-right: 9px;
padding-top: 1px;
text-align: center;
padding-bottom: 1px;
font-size: 19px;
font-family: 'Gill Sans';
border-radius: 10px;
border-width: 3px;
margin-left: 77px;
border-color: rgba(255, 192, 203, 0.637);
display: flex;
margin-top: 8px;
text-align: center;
transition: 0.15s;
width:154px;
}

.stars2{ 
color: #ffb6c1;
background-color: white;
padding-left: 9px;
padding-right: 9px;
padding-top: 1px;
padding-bottom: 1px;
font-size: 19px;
font-family: 'Gill Sans';
border-radius: 10px;
text-align: center;
border-width: 3px;
margin-top: -33.5px;
margin-left: 243px;
border-color: rgba(255, 192, 203, 0.637);
display: flex;
text-align: center;
width:123px;
transition: 0.15s;
}

.stars3{ 
color: #ffb6c1;
background-color: white;
padding-left: 9px;
padding-right: 9px;
padding-top: 1px;
text-align: center;
padding-bottom: 1px;
font-size: 19px;
font-family: 'Gill Sans';
border-radius: 10px;
border-width: 3px;
margin-top: -33.5px;
margin-left: 378px;
border-color: rgba(255, 192, 203, 0.637);
display: flex;
text-align: center;
transition: 0.15s;
width:150px;
}

.popup {
  position: absolute;
  top: 0;
  left: 0;
  width: 100vw;
  height: 100vh;
  margin-top: -49.5px;
margin-left: -155px;
  background-color: rgba(255, 192, 203, 0.6);
  display: none;
  justify-content: center;
  align-items: center;
  z-index: 99999;
}

/* Shared animation */
@keyframes popupFade {
  0% {
    opacity: 0;
    transform: scale(0.7) translateY(30px);
  }
  60% {
    opacity: 1;
    transform: scale(1.05) translateY(-10px);
  }
  100% {
    transform: scale(1) translateY(0);
  }
}

/* Default popup content box */
.popup-content {
  background-color: white;
  padding: 36px;
  border-radius: 15px;
  box-shadow: 0 6px 28px rgba(0, 0, 0, 0.32);
  font-family: 'Gill Sans';
  color: palevioletred;
  font-size: 20px;
  max-width: 860px;   /* bigger start popup */
  width: 90%;
  text-align: center;
  animation: popupFade 0.6s ease forwards;
  position: absolute;
}
.popup-start-content {
  max-width: 700px;
  padding: 40px;
  border-radius: 20px;
}

.popup-title {
  font-size: 26px;
  margin-bottom: 15px;
  color: #ff69b4;
  font-family: 'Lucida Handwriting', cursive;
}

.popup-desc {
  font-size: 18px;
  color: palevioletred;
  font-family: 'Gill Sans';
  line-height: 1.5;
}

.close-btn {
  position: absolute;
  top: 10px;
  right: 15px;
  font-size: 24px;
  cursor: pointer;
  color: palevioletred;
}

.popup-buttons {
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
  gap: 12px;
  margin-top: 12px;
}



.cattt {
  position: absolute;
  top: 0;
  left: 0;
  width: 100.2vw;
  height: 100vh;
  margin-top: -84px;
  margin-left: -80px;
  background-color: rgba(255, 192, 203, 0.6);
  display: none;
  justify-content: center;
  align-items: center;
  z-index: 99999;
}

/* Shared animation */
@keyframes popupFade {
  0% {
    opacity: 0;
    transform: scale(0.7) translateY(30px);
  }
  60% {
    opacity: 1;
    transform: scale(1.05) translateY(-10px);
  }
  100% {
    transform: scale(1) translateY(0);
  }
}

/* Default popup content box */
.cat-content {
  background-color: white;
  padding: 30px;
  border-radius: 15px;
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
  font-family: 'Gill Sans';
  color: palevioletred;
  font-size: 20px;
  max-width: 500px;
  width: 80%;
  text-align: center;
  animation: popupFade 0.6s ease forwards;
  position: absolute;
}
.popup-start-content {
  max-width: 700px;
  padding: 40px;
  border-radius: 20px;
}

.cat-title {
  font-size: 26px;
  margin-bottom: 15px;
  color: #ff69b4;
  font-family: 'Lucida Handwriting', cursive;
}

.cat-desc {
  font-size: 18px;
  color: palevioletred;
  font-family: 'Gill Sans';
  line-height: 1.5;
}

.close-btn {
  position: absolute;
  top: 10px;
  right: 15px;
  font-size: 24px;
  cursor: pointer;
  color: palevioletred;
}


.popo {
  position: absolute;
  top: 0;
  left: 0;
  width: 100.2vw;
  height: 100vh;
  margin-top: -2px;
  margin-left: -1px;
  background-color: rgba(255, 192, 203, 0.6);
  display: none;
  justify-content: center;
  align-items: center;
  z-index: 99999;
}

/* Shared animation */
@keyframes popoFade {
  0% {
    opacity: 0;
    transform: scale(0.7) translateY(30px);
  }
  60% {
    opacity: 1;
    transform: scale(1.05) translateY(-10px);
  }
  100% {
    transform: scale(1) translateY(0);
  }
}

.popo-content {
  background-color: white;
  padding: 30px;
  border-radius: 15px;
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
  font-family: 'Gill Sans';
  color: palevioletred;
  font-size: 20px;
  max-width: 500px;
  width: 80%;
  text-align: center;
  animation: popupFade 0.6s ease forwards;
  position: absolute;
}
.popo-start-content {
  max-width: 700px;
  padding: 40px;
  border-radius: 20px;
}

.popo-title {
  font-size: 26px;
  margin-bottom: 15px;
  color: #ff69b4;
  font-family: 'Lucida Handwriting', cursive;
}

.popo-desc {
  font-size: 18px;
  color: palevioletred;
  font-family: 'Gill Sans';
  line-height: 1.5;
}

.popup-buttons {
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
  gap: 17px;
  font-size: 30px;
  margin-top: 20px;}

  .close-btn {
  position: absolute;
  top: 10px;
  right: 15px;
  font-size: 24px;
  cursor: pointer;
  color: palevioletred;
}


.catt {
  position: fixed;
  top: 0;
  left: 0;
  width: 100vw;
  height: 100vh;
  background-color: rgba(255, 192, 203, 0.6);
  display: none;
  justify-content: center;
  align-items: center;
  z-index: 99999;
}

.catt-content {
  background-color: white;
  padding: 30px;
  border-radius: 15px;
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
  font-family: 'Gill Sans';
  color: palevioletred;
  font-size: 20px;
  max-width: 500px;
  width: 80%;
  text-align: center;
  position: relative;
  animation: popupFade 0.6s ease forwards;
}

/* NEW: naven popup styles */
    .naven {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background-color: rgba(255, 192, 203, 0.6);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 100000;
    }

    .naven-content {
      background-color: white;
      padding: 32px;
      border-radius: 16px;
      box-shadow: 0 8px 40px rgba(0,0,0,0.28);
      font-family: 'Gill Sans';
      color: palevioletred;
      max-width: 920px;    /* increased popup width */
      width: 92%;
      text-align: center;
      position: relative;
      animation: popupFade 0.5s ease forwards;
     /* allow popup content to scroll when tall (enables scrolling during letter) */
     max-height: calc(100vh - 80px);
     overflow: auto;
     -webkit-overflow-scrolling: touch;
    }
    
    .naven-title {
      font-family: 'Lucida Handwriting', cursive;
      color: #ff69b4;
      font-size: 26px;
      margin-bottom: 10px;
    }

    .naven-desc {
      color: palevioletred;
      font-size: 18px;
      line-height: 1.4;
    }

    .naven .close-btn {
      top: 10px;
      right: 12px;
      color: palevioletred;
    }

    /* NEW: wish photo popup styles */
    .wish-photo-container {
      position: relative;
      overflow: visible; /* allow overlay to expand beyond image if needed */
    }

    /* let image scale naturally so overlay isn't constrained/cut */
    .wish-photo-container img {
      width: 100%;
      border-radius: 10px;
      display: block;
      height: auto;
      max-height: 70vh; /* prevent huge images but allow overlay room */
      object-fit: cover;
    }

    /* centered, multiline overlay that won't be clipped */
    .wish-photo-overlay {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      color: #fff;
      font-size: 20px;
      text-shadow: 0 2px 8px rgba(0,0,0,0.6);
      background: rgba(0,0,0,0.32);
      padding: 12px 16px;
      border-radius: 12px;
      width: 88%;
      max-width: 92%;
      box-sizing: border-box;
      text-align: center;
      white-space: pre-wrap;    /* preserve line breaks */
      word-break: break-word;
      overflow: visible;        /* don't cut off content */
      z-index: 5;
      line-height: 1.3;
    }

    .wish-photo-close {
      position: absolute;
      top: 8px;
      right: 8px;
      font-size: 20px;
      color: palevioletred;
      background: white;
      width: 34px;
      height: 34px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      box-shadow: 0 2px 8px rgba(0,0,0,0.15);
    }

    /* NEW: cake popup styles (replaced to match provided illustration; no images used) */
    .cake-popup .naven-content { max-width:760px; padding:28px; }
    .cake-popup { display: none; }
    .cake-img {
      display: block;
      margin: 8px auto 0;
      width: 200px;       /* small image */
      height: auto;
      border-radius: 12px;
      box-shadow: 0 10px 20px rgba(0,0,0,0.28);
      object-fit: contain;
    }

    /* letter popup styles */
    .letter-body {
      font-family: "Lucida Handwriting", cursive;
      font-size: 16px; /* made a little smaller */
      line-height: 1.9;
      color: #c2185b;                /* palevioletred-ish */
      max-width: 760px;
      margin: 12px auto;
      text-align: left;
      white-space: pre-wrap;
      letter-spacing: 0.2px;
      padding: 6px 10px;
     /* allow the letter itself to scroll if it overflows the popup */
     max-height: calc(100vh - 260px);
     overflow: auto;
     -webkit-overflow-scrolling: touch;
    }
    /* image popup for letter: make it a small floating mini-popup */
    .letter-image-popup {
      /* position as a floating mini popup inside the naven-content */
      position: absolute;
      top: 16px;                 /* same position, slightly adjusted */
      right: 18px;               /* same position, slightly adjusted */
      width: 150px;              /* made a little smaller */
      max-width: 32%;
      margin-right: 20px;
      background: rgba(255,255,255,0.98);
      padding: 6px;              /* reduced padding */
      border-radius: 10px;
      box-shadow: 0 8px 22px rgba(0,0,0,0.22);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 1200;
      transition: opacity 220ms ease, transform 220ms ease;
      opacity: 0;
      transform: translateY(-6px) scale(0.96);
      pointer-events: none;
    }
    .letter-image-popup.show {
      display: flex;
      opacity: 1;
      transform: translateY(0) scale(1);
      pointer-events: auto;
    }
    .letter-image-popup img {
      width: 100%;
      height: auto;
      max-height: 36vh;   /* slightly smaller max height */
      border-radius: 6px;
      display: block;
    }
  </style>
</head>
<body>

<audio id="intro" src="happy-birthday-piano-variations-117314.mp3" autoplay></audio>

  
<canvas id="confetti-canvas"></canvas>
  
  <div class="container">
    <div class="envelope" id="envelope" onclick="openEnvelope()">
      <div class="flap"></div>
    </div>


<div id="noPopup" class="cattt">
  <div class="cat-content">
    <span class="close-btn" onclick="closeNoPopup()">√ó</span>
    <h2 class="cat-title">‚ô°‚äπ Wait... really? ‚äπ‚ô° <br>‚ô°‚äπ  üò≠üò≠üòûüò¢üíîüíî ‚äπ‚ô°</h2>
    <p class="cat-desc">You sure you don‚Äôt wanna open the envelope??</p>
    <img src="Cute Cat pookie üéÄ.jpg" alt="Sad cat" style="width: 58%; border-radius: 10px; margin-top: 15px;" />
    <p class="cat-desc">ME RIGHT NOW IF YOU DONT<br> üò≠üò≠üòûüò¢üíîüíî</p>
  </div>
</div>




<div id="messageBox" class="white-box">
  <div id="popup" class="popup">
    <div class="popup-content" id="popupContent">
      <span class="close-btn" onclick="closePopup()">√ó</span>
      <h2 id="popupTitle" class="popup-title">‚ô°‚äπ Title ‚äπ‚ô°</h2>
      <p id="popupDesc" class="popup-desc">Description goes here!</p>
    </div>
  </div>

  <button class="star"> ‚ÇäÀö‚äπ‚ô° Start ‚ÇäÀö‚äπ‚ô°</button>
  <button class="stars"> ‚ô°‚äπ Settings ‚äπ‚ô°</button>
  <button class="stars2"> ‚ô°‚äπ Info ‚äπ‚ô°</button>
  <button class="stars3"> ‚ô°‚äπ Contact ‚äπ‚ô°</button>
</div>
  </div>

  <div id="startPopup" class="popo">
  <div class="popo-content">
    <span class="close-btn" onclick="closeStartPopup()">√ó</span>
    <h2 class="popo-title">‚ô°‚äπ Navigation ‚äπ‚ô°</h2>
    <p class="popo-desc"> Lets open this Birthday website! <br> .Ôæü *Íï§*.Ôæü Choose One >‚©ä< .Ôæü *Íï§*.Ôæü </p>
 <div class="popup-buttons">
      <button class="open"> ‚ú® Cake ‚ú® </button>
      <button class="open"> üß∏ Wishes üß∏ </button>
      <button class="open"> üå∏ Letter üå∏ </button>
      <button class="open"> üéÅ Gift üéÅ </button>
    </div>
  </div>
</div>

  <p class="footer-text">
    UuUUuU A letter! Wanna open it :3?
  </p>

  <div style="text-align: center;">
  <button class="open" onclick="openEnvelope()"> ‚ãÜ¬∞.‚ãÜ‚ô° OPEN ‚ô°‚ãÜ.¬∞‚ãÜ</button>
  <button class="no" onclick="handleNo()">Àô‚ó†Àô No Àô‚ó†Àô</button>
</div>

<!-- SETTINGS POPUP -->
<div id="settingsPopup" class="catt">
  <div class="catt-content">
    <span class="close-btn" onclick="closePopup('settingsPopup')">√ó</span>
    <h2 class="cat-title">‚ô°‚äπ Settings ‚äπ‚ô°</h2>
    <p class="cat-desc">Settings are locked because you're already ‚úßperfect‚úß. No tweaks needed!</p>
    <img src="cute.png" alt="Sad cat" style="width: 39%; border-radius: 10px; margin-top: 15px;" />
    <p class="cat-desc">‚âΩ(‚Ä¢‚©ä ‚Ä¢„Éû‚âº</p>
  </div>
</div>

<!-- INFO POPUP -->
<div id="infoPopup" class="catt">
  <div class="catt-content">
    <span class="close-btn" onclick="closePopup('infoPopup')">√ó</span>
    <h2 class="cat-title">‚ô°‚äπ Info ‚äπ‚ô°</h2>
    <p class="cat-desc">You're loved, You're Smart, Your ma Bestie! TODAY is all about YOOOOOUUUUU!!</p>
    <img src="download.jpg" alt="Sad cat" style="width: 58%; border-radius: 10px; margin-top: 15px;" />
    <p class="cat-desc">‚âΩ(‚Ä¢‚©ä ‚Ä¢„Éû‚âº</p>
  </div>
</div>

<!-- CONTACT POPUP -->
<div id="contactPopup" class="catt">
  <div class="catt-content">
    <span class="close-btn" onclick="closePopup('contactPopup')">√ó</span>
    <h2 class="cat-title">‚ô°‚äπ Contact ‚äπ‚ô°</h2>
    <p class="cat-desc">Just scream 'BESTIE' and I‚Äôll appear!</p>
    <img src="fwend.jpg" alt="Sad cat" style="width: 58%; border-radius: 10px; margin-top: 15px;" />
    <p class="cat-desc">‚âΩ(‚Ä¢‚©ä ‚Ä¢„Éû‚âº</p>
  </div>
</div>


<!-- NEW: naven popup (shown when Cake / Wishes / Letter / Gift clicked) -->
<div id="navenPopup" class="naven" aria-hidden="true">
  <div class="naven-content">
    <span class="close-btn" onclick="closeNavenPopup()">√ó</span>
    <h2 id="navenTitle" class="naven-title">‚ô°‚äπ Something ‚ô°‚äπ</h2>
    <p id="navenDesc" class="naven-desc">Popup content</p>

    <!-- NEW: wish form (hidden by default, shown when Wishes clicked) -->
    <div id="wishForm" style="display:none; margin-top:12px;">
      <textarea id="wishText" placeholder="Type your wish here..." rows="4" style="width:80%; font-size: 19px; padding:8px; border-radius:8px; border:1px solid rgba(255,192,203,0.6); font-family:'Gill Sans'; resize: none;"></textarea>
      <div style="margin-top:10px; text-align:center;">
        <button id="wishSubmit" class="open" onclick="blowCandle()" style="background:pink; color:white; border-radius:8px; padding:8px 16px; font-family:'Gill Sans'; border:none; cursor:pointer;">‚ô°‚äπ Submit ‚ô°‚äπ</button>
      </div>
    </div>
  </div>
</div>

<!-- NEW: popup that shows the photo after submitting a wish -->
<div id="wishPhotoPopup" class="naven" aria-hidden="true" style="display:none; opacity:0; transition: opacity 0.6s ease;">
  <div class="naven-content" style="max-width:640px; padding:12px 16px;">
    <div class="wish-photo-container">
      <div class="wish-photo-close" onclick="closeWishPhotoPopup()">√ó</div>
      <!-- set image file to the requested filename -->
      <img id="wishPhotoImg" src="‚Äî meowl_.jpg" alt="Wish photo" style="display:none;" />
       <div id="wishOverlayText" class="wish-photo-overlay"></div>
      </div>
    </div>
  </div>
</div>

<!-- NEW: cake popup markup (shown when Cake clicked) -->
<div id="cakePopup" class="naven cake-popup" aria-hidden="true" style="display:none;">
  <div class="naven-content">
    <span class="close-btn" onclick="closeCakePopup()">√ó</span>
    <h2 class="naven-title">‚ú® Cake ‚ú®</h2>
    <p class="naven-desc">Make a wish ‚Äî blow the candle!</p>
    <!-- replaced CSS cake with an image: start image is cake1.png -->
    <img id="cakeImg" class="cake-img" src="cake1.png" alt="Decorative cake" />
    <!-- if you want a candle-blow effect later, use a separate flame overlay or animated GIF -->
    <div style="margin-top:16px;">
      <button id="blowBtn" class="open" onclick="blowCandle()">‚ô°‚äπ Blow ‚ô°‚äπ</button>
    </div>
   </div>
 </div>
 <!-- end cake popup -->



<div id="giftPopup" class="naven gift-popup" aria-hidden="true" style="display:none;">
  <div class="naven-content">
    <span class="close-btn" onclick="closeGiftPopup()">√ó</span>
    <h2 class="naven-title"> üéÅ Gift üéÅ</h2>
    <p class="naven-desc">Hope you like your gift!</p>
    <!-- replaced CSS cake with an image: start image is cake1.png -->
    <img id="cakeImg" class="cake-img" src="fwend.jpg" alt="Decorative cake" />
    <!-- if you want a candle-blow effect later, use a separate flame overlay or animated GIF -->
    <div style="margin-top:16px;">
      <button id="blowBtn" class="open" onclick="blowCandle()">üéâ Confetti ‡∏Ö^>‚©ä<^‡∏Ö</button>
    </div>
   </div>
 </div>


 <!-- LETTER POPUP (typewriter reveal) -->
  <div id="letterPopup" class="naven" aria-hidden="true" style="display:none;">
     <div class="naven-content" style="max-width:760px; padding:36px;">
       <span class="close-btn" onclick="closeLetterPopup()">√ó</span>
       <h2 class="naven-title">‚ô°‚äπ A Letter for Rhian ‚äπ‚ô°</h2>
       <div id="letterBody" class="letter-body" aria-live="polite" ></div>
      <!-- image popup used while letter is visible; filenames can be adjusted in JS -->
      <div id="letterImagePopup" class="letter-image-popup" aria-hidden="true">
        <img id="letterImageElem" src="" alt="decoration" />
      </div>
     </div>
   </div>

<script>
/* Cleaned/merged script
   - guards .play() calls
   - removes duplicated functions
   - single popup show/close helpers
   - kept letter typing and image cycle (1..6) with no-back-to-back repeats
   - robust wish photo loader with fallbacks
*/

(function () {
  // safe DOM helpers
  const $ = id => document.getElementById(id);
  function safePlay(id) { try { const a = $(id); if (a && typeof a.play === 'function') a.play(); } catch (e) { console.warn('audio play failed', id, e); } }

  // Intro play once DOM loaded
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', () => safePlay('intro'));
  } else {
    safePlay('intro');
  }

  // Canvas confetti setup
  const canvas = $('confetti-canvas');
  const ctx = canvas && canvas.getContext ? canvas.getContext('2d') : null;
  function setCanvasSize() {
    if (!canvas) return;
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
  }
  setCanvasSize();
  window.addEventListener('resize', setCanvasSize);

  const pastelColors = [
    "rgba(255,182,193,0.9)",
    "rgba(255,105,180,0.9)",
    "rgba(255,255,153,0.9)",
    "rgba(255,239,184,0.9)",
    "rgba(173,216,230,0.9)",
    "rgba(135,206,250,0.9)"
  ];

  let confetti = [];
  let animationFrame = null;

  function animateConfetti() {
    if (!ctx) return;
    function draw() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      confetti.forEach((c) => {
        ctx.beginPath();
        ctx.lineWidth = c.r;
        ctx.strokeStyle = c.color;
        ctx.moveTo(c.x + c.tilt, c.y);
        ctx.lineTo(c.x, c.y + c.tilt + c.r);
        ctx.stroke();
        c.tiltAngle += c.tiltAngleIncrement;
        c.y += (c.d / 2);
        c.x += Math.sin(c.tiltAngle) * 2;
        c.tilt = Math.sin(c.tiltAngle) * 15;
      });
      confetti = confetti.filter(c => c.y < canvas.height + 20);
      if (confetti.length) animationFrame = requestAnimationFrame(draw);
      else { cancelAnimationFrame(animationFrame); animationFrame = null; }
    }
    if (!animationFrame) draw();
  }

  function createConfettiBurst() {
    const start = Date.now();
    (function gen() {
      if (Date.now() - start < 1500) {
        for (let i = 0; i < 10; i++) {
          confetti.push({
            x: Math.random() * canvas.width,
            y: -10,
            r: Math.random() * 6 + 4,
            d: Math.random() * 10 + 5,
            color: pastelColors[Math.floor(Math.random() * pastelColors.length)],
            tilt: Math.random() * 10 - 5,
            tiltAngle: 0,
            tiltAngleIncrement: Math.random() * 0.07 + 0.05
          });
        }
        setTimeout(gen, 100);
      }
    })();
    animateConfetti();
  }

  // Generic popup helpers
  function showEl(id) { const el = $(id); if (el) el.style.display = 'flex'; }
  function hideEl(id) { const el = $(id); if (el) el.style.display = 'none'; }

  // Envelope open (safe audio calls)
  function openEnvelope() {
    safePlay('hbd');
    const envelope = $('envelope');
    const flap = envelope ? envelope.querySelector('.flap') : null;
    const messageBox = $('messageBox');
    if (flap) flap.style.transform = 'rotateX(-180deg)';
    setTimeout(() => {
      if (envelope) { envelope.style.opacity = '0'; envelope.style.pointerEvents = 'none'; }
      if (messageBox) messageBox.style.display = 'flex';
      createConfettiBurst();
    }, 800);
  }
  window.openEnvelope = openEnvelope;

  // Consolidated closePopup - supports two usages in markup:
  //   closePopup()  -> closes element with id 'popup'
  //   closePopup('settingsPopup') -> closes provided id
  window.closePopup = function(id) {
    const el = $(id || 'popup');
    if (el) el.style.display = 'none';
  };

  // no-popup handlers
  window.handleNo = function () {
    // show the "no" modal if present, otherwise alert fallback
    if ($('noPopup')) showEl('noPopup');
    else alert("No button clicked!");
    safePlay('no');
  };
  window.closeNoPopup = function () { hideEl('noPopup'); };

  // Start popup control
  function openStartPopup() { showEl('startPopup'); }
  function closeStartPopup() { hideEl('startPopup'); }
  window.closeStartPopup = closeStartPopup;
  const starBtn = document.querySelector('.star');
  if (starBtn) starBtn.addEventListener('click', openStartPopup);

  // top nav buttons
  const starsBtn = document.querySelector('.stars');
  if (starsBtn) starsBtn.addEventListener('click', () => showEl('settingsPopup'));
  const stars2Btn = document.querySelector('.stars2');
  if (stars2Btn) stars2Btn.addEventListener('click', () => showEl('infoPopup'));
  const stars3Btn = document.querySelector('.stars3');
  if (stars3Btn) stars3Btn.addEventListener('click', () => showEl('contactPopup'));

  // Gift / Cake simple show/close
  window.showGiftPopup = function() { showEl('giftPopup'); };
  window.closeGiftPopup = function() { hideEl('giftPopup'); };
  window.showCakePopup = function() { showEl('cakePopup'); };
  window.closeCakePopup = function() { hideEl('cakePopup'); };

  // cake blow sequence (safe)
  window.blowCandle = function() {
    const img = $('cakeImg');
    const btn = $('blowBtn');
    if (!img || !btn) return;
    btn.disabled = true;
    btn.textContent = 'Blowing‚Ä¶';
    btn.style.opacity = '0.86';
    img.style.transition = img.style.transition || 'opacity 240ms ease';
    const blowingSrc = encodeURI('cake-blowing.png');
    const blownSrc = encodeURI('cake-blown.png');
    let finished = false;
    function setSrcWithFade(src, cb) {
      img.style.opacity = '0';
      setTimeout(() => {
        const onLoad = () => { img.removeEventListener('load', onLoad); img.removeEventListener('error', onErr); requestAnimationFrame(() => img.style.opacity = '1'); if (cb) cb(null); };
        const onErr = () => { img.removeEventListener('load', onLoad); img.removeEventListener('error', onErr); requestAnimationFrame(() => img.style.opacity = '1'); if (cb) cb(new Error('load')); };
        img.addEventListener('load', onLoad);
        img.addEventListener('error', onErr);
        img.src = src;
      }, 220);
    }
    setSrcWithFade(blowingSrc, () => {
      setTimeout(() => {
        setSrcWithFade(blownSrc, () => {
          try { createConfettiBurst(); } catch (e) {}
          btn.textContent = 'Blown ‚úì';
          btn.style.cursor = 'default';
          finished = true;
        });
      }, 1100);
    });
    setTimeout(() => {
      if (!finished) { try { createConfettiBurst(); } catch (e) {} btn.textContent = 'Blown ‚úì'; btn.style.cursor = 'default'; }
    }, 4000);
  };

  // Robust wish submit (uses #wishSubmit)
  (function initWishSubmit() {
    const submit = $('wishSubmit');
    if (!submit) return;
    // remove any inline onclick interference by overriding
    submit.addEventListener('click', function (e) {
      e.preventDefault();
      try { window.closeNavenPopup && window.closeNavenPopup(); } catch (er) {}
      const popup = $('wishPhotoPopup');
      const img = $('wishPhotoImg');
      const overlay = $('wishOverlayText');
      if (!popup || !img || !overlay) return;
      overlay.textContent = '‚ô°‚äπÀö‚Çä May your wish come true ‚ÇäÀö‚äπ‚ô°';
      const files = ['‚Äî meowl_.jpg', '--meowl.jpg', 'meowl.jpg', 'download.jpg'];
      let idx = 0;
      let shown = false;
      let hideTimeout = null;

      function hidePopupLater() {
        clearTimeout(hideTimeout);
        hideTimeout = setTimeout(() => {
          popup.style.opacity = '0';
          setTimeout(() => { popup.style.display = 'none'; popup.setAttribute('aria-hidden', 'true'); }, 600);
        }, 3000);
      }

      popup.style.display = 'flex';
      popup.setAttribute('aria-hidden', 'false');
      popup.style.opacity = '0';
      overlay.style.display = 'block';
      img.style.display = 'none';
      requestAnimationFrame(() => { popup.style.opacity = '1'; });

      img.onload = function () { img.style.display = 'block'; overlay.style.display = 'block'; shown = true; hidePopupLater(); };
      img.onerror = function () {
        idx++;
        if (idx < files.length) { img.src = encodeURI(files[idx]); return; }
        img.style.display = 'none'; overlay.style.display = 'block'; shown = true; hidePopupLater();
      };

      img.src = encodeURI(files[0]);
      setTimeout(() => { if (!shown) hidePopupLater(); }, 800);
    }, { passive: false });
  })();

  // NAV popup logic: map label to content & actions
  (function setupNavenButtons() {
    function getPopupTextFor(label) {
      const t = String(label).toLowerCase();
      if (t.includes('cake')) return { title: '‚ú® ‚ú¥Ô∏é‚ãÜ Cake ‚ãÜ‚ú¥‚ú®', desc: 'Cake! - Blow the Candless! üéÇ', action: 'cake' };
      if (t.includes('wishes') || t.includes('wish')) return { title: 'üß∏ ‚ú¥Ô∏é‚ãÜ Wishes ‚ãÜ‚ú¥ üß∏', desc: 'Type your wish heree ‚âΩ(‚Ä¢‚©ä ‚Ä¢„Éû‚âº', action: 'wishes' };
      if (t.includes('letter')) return { title: 'üå∏ ‚ú¥Ô∏é‚ãÜ Letter ‚ãÜ‚ú¥ üå∏', desc: 'A little letter full of love and memories. ‚úâÔ∏è', action: 'letter' };
      if (t.includes('gift') || t.includes('present')) return { title: 'üéÅ ‚ú¥Ô∏é‚ãÜ Gift ‚ãÜ‚ú¥ üéÅ', desc: 'I hope you like your gift :3', action: 'gift' };
      return { title: label, desc: '', action: null };
    }

    window.showNavenPopup = function(label) {
      const info = getPopupTextFor(label);
      const titleEl = $('navenTitle'), descEl = $('navenDesc');
      if (titleEl) titleEl.textContent = info.title;
      if (descEl) descEl.textContent = info.desc;
      // handle actions
      if (info.action === 'letter') { try { window.closeNavenPopup(); } catch (e) {} showLetterPopup(); return; }
      if (info.action === 'cake') { hideEl('navenPopup'); showCakePopup(); return; }
      if (info.action === 'gift') { hideEl('navenPopup'); showGiftPopup(); return; }
      if (info.action === 'wishes') { // show wish form within naven
        const wishForm = $('wishForm'); if (wishForm) wishForm.style.display = 'block';
      } else {
        const wishForm = $('wishForm'); if (wishForm) wishForm.style.display = 'none';
      }
      showEl('navenPopup');
      $('navenPopup') && $('navenPopup').setAttribute('aria-hidden', 'false');
    };

    window.closeNavenPopup = function() { hideEl('navenPopup'); $('navenPopup') && $('navenPopup').setAttribute('aria-hidden', 'true'); };

    // attach the 4 startPopup buttons
    const startButtons = document.querySelectorAll('#startPopup .open');
    startButtons.forEach(btn => btn.addEventListener('click', function () {
      const label = (this.textContent || this.innerText || '').trim();
      showNavenPopup(label);
    }));
  })();

  // LETTER logic (typewriter + image cycle)
  const letterText = `My dear Bestie ‚óù(·µî·óú·µî)‚óú


Happy birthday, my dearest bestie. I hope you're doing well. Today is just not December 8, but your sweet sixteen birthday. a reminder of your years of journey and your achievements. But most of all, it's a celebration of what's to come.

May your wishes, prayers, and dreams be fulfilled, and may your standards and promises hold true. May God always be with you. As your bestie, I want you to know how much I love you. No matter how far apart we may be, my love remains strong‚Äîfor you as my non-biological sister, bestie, cat twin, and companion. I hope we continue to grow together always.

May the rest of your day be filled with love and happiness, and even reach or surpass your standards. May your guests be able to properly show how much they love you, and may peace guide our party.

Once again, may you have a great celebration, and your day will be filled with love and care- just not today, but every day (^-^)!


From
Precious A, Bestie ‚âΩ(‚Ä¢‚©ä ‚Ä¢„Éû‚âº`;

  let _letterTyping = { running: false, timer: null, stop: false };

  function showLetterPopup() {
    _letterTyping.stop = true;
    clearTimeout(_letterTyping.timer);
    const popup = $('letterPopup');
    const body = $('letterBody');
    if (!popup || !body) return;
    showEl('letterPopup');
    popup.setAttribute('aria-hidden', 'false');
    requestAnimationFrame(() => { popup.style.opacity = '1'; });
    body.innerHTML = '';
    _letterTyping = { running: true, timer: null, stop: false };
    const paragraphs = letterText.split(/\n\s*\n/);
    let pIndex = 0;
    startLetterImageCycle();
    body.scrollTop = 0;
    if (body.focus) body.focus();

    function typeParagraph() {
      if (_letterTyping.stop) return;
      if (pIndex >= paragraphs.length) { _letterTyping.running = false; return; }
      const para = paragraphs[pIndex].trim();
      const pEl = document.createElement('div');
      pEl.style.marginBottom = '14px';
      body.appendChild(pEl);

      let i = 0;
      function typeChar() {
        if (_letterTyping.stop) return;
        if (i <= para.length - 1) {
          pEl.innerHTML = para.slice(0, i + 1).replace(/\*/g, '');
          i++;
          const char = para.charAt(i - 1);
          let delay = 28;
          if (/[.,!?]/.test(char)) delay = 140;
          else if (/\s/.test(char)) delay = 18;
          _letterTyping.timer = setTimeout(typeChar, delay);
        } else {
          pIndex++;
          _letterTyping.timer = setTimeout(typeParagraph, 420);
        }
      }
      typeChar();
    }
    _letterTyping.timer = setTimeout(typeParagraph, 220);
  }
  window.showLetterPopup = showLetterPopup;

  function closeLetterPopup() {
    _letterTyping.stop = true;
    clearTimeout(_letterTyping.timer);
    stopLetterImageCycle();
    const popup = $('letterPopup');
    if (!popup) return;
    popup.style.opacity = '0';
    setTimeout(() => { hideEl('letterPopup'); popup.setAttribute('aria-hidden', 'true'); }, 420);
  }
  window.closeLetterPopup = closeLetterPopup;

  // --- letter image cycle: random 1..6 (random/X.jpg), avoid same twice in a row ---
  let _letterImageInterval = null;
  let _letterImageTimeout = null;
  let _letterPrevIndex = null;

  function startLetterImageCycle() {
    stopLetterImageCycle();
    const popupImg = $('letterImageElem');
    const popupWrap = $('letterImagePopup');
    if (!popupWrap || !popupImg) return;
    const displayMs = 2600;

    function pickDifferentIndex() {
      let n = Math.floor(Math.random() * 6) + 1;
      let attempts = 0;
      while (n === _letterPrevIndex && attempts < 8) { n = Math.floor(Math.random() * 6) + 1; attempts++; }
      _letterPrevIndex = n;
      return n;
    }

    function showOnce() {
      const n = pickDifferentIndex();
      const src = encodeURI(`random/${n}.jpg`);
      popupImg.style.transition = popupImg.style.transition || 'opacity 180ms ease';
      popupImg.style.opacity = '0';
      setTimeout(() => {
        popupImg.onload = () => requestAnimationFrame(() => { popupImg.style.opacity = '1'; });
        popupImg.onerror = () => { console.warn('letter image failed to load:', src); popupImg.style.opacity = '1'; };
        popupImg.src = src;
        popupWrap.classList.add('show');
        popupWrap.setAttribute('aria-hidden', 'false');
        clearTimeout(_letterImageTimeout);
        _letterImageTimeout = setTimeout(() => {
          popupWrap.classList.remove('show');
          popupWrap.setAttribute('aria-hidden', 'true');
        }, displayMs);
      }, 160);
    }

    showOnce();
    _letterImageInterval = setInterval(showOnce, displayMs + 700);
  }

  function stopLetterImageCycle() {
    clearInterval(_letterImageInterval); _letterImageInterval = null;
    clearTimeout(_letterImageTimeout); _letterImageTimeout = null;
    const popupWrap = $('letterImagePopup'); if (popupWrap) { popupWrap.classList.remove('show'); popupWrap.setAttribute('aria-hidden', 'true'); }
  }

  // expose stop function (used when closing)
  window.stopLetterImageCycle = stopLetterImageCycle;

  // Expose a few functions for markup onclicks that remain in the HTML
  window.closeCakePopup = closeCakePopup;
  window.showCakePopup = showCakePopup;
  window.closeGiftPopup = closeGiftPopup;
})();
</script>

</body>

</html>




